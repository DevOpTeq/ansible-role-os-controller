---
# Pre deployment tasks

- name: Install required packages
  yum: name="{{ item }}" state=latest update_cache=yes
  with_items:
    - curl
    - git
    - python-devel
    - python-pip
    - tar
    - bind-utils
    - wget
    - httpd
    - memcached
    - mod_wsgi
    - rabbitmq-server
    - iptables

- name: Install yum-plugin-priorities and epel-release
  yum: name="{{ item }}" state=latest
  with_items:
    - epel-release
    - yum-plugin-priorities

- name: Install Openstack "{{ openstack_version | default(liberty) }}"  packages
  yum: name="{{ item }}" state=latest
  with_items:
    - centos-release-openstack-{{ openstack_version | default(liberty) }}

- name: Install python-openstackclient
  yum: name="{{ item }}" state=latest
  with_items:
    - python-openstackclient

# USEFUL?--->>>>
- name: Upudate cache and install the openstack-selinux package
  yum: name="{{ item }}" state=latest update_cache=yes
   # update_cache=yes
  with_items:
    - openstack-selinux

# openstack shade will be used later on in the deploy/config of OS
- name: pip update and install openstack shade
  pip: name="{{ item }}" state=latest
  with_items:
    - pip
    - shade

#http
- name: Configure httpd Listen Port.
  lineinfile: >
    dest=/etc/httpd/conf/httpd.conf
    regexp="{{ item.regexp }}"
    line="{{ item.line }}"
    state=present
  with_items:
    - { regexp: "^#?Listen", line: "Listen {{ openstack_controller_host }}:80" }

- name: Start http daemon.
  service: "name={{ item }} state=started enabled=yes"
  with_items:
    - httpd